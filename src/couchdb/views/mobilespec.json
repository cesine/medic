{
    "_id" : "_design/results",
    "views" : {
        "android" : {
            "map" : ["function(doc){",
                         "if (doc.platform == 'android' && doc.mobilespec) {",
                            "function getFailures(suites) {",
                                "var fails = [];",
                                "suites.forEach(function(suite) {",
                                    "suite.specs.forEach(function(spec) {",
                                        "if (!spec.passed) {",
                                            "spec.failures.forEach(function(fail) {",
                                                "fails.push(fail);",
                                            "});",
                                        "}",
                                    "});",
                                    "fails.concat(getFailures(suite.suites));",
                                "});",
                                "return fails;",
                            "};",
                             "emit(doc.sha, {",
                                "\"total\":doc.mobilespec.total,",
                                "\"passed\":(doc.mobilespec.total - doc.mobilespec.failed),",
                                "\"version\":doc.version,",
                                "\"model\":doc.model,",
                                "\"fails\":getFailures(doc.mobilespec.suites)",
                             "});",
                         "}",
                     "}"].join('')
        },
        "blackberry" : {
            "map" : ["function(doc){",
                         "if (doc.platform == 'blackberry' && doc.mobilespec) {",
                            "function getFailures(suites) {",
                                "var fails = [];",
                                "suites.forEach(function(suite) {",
                                    "suite.specs.forEach(function(spec) {",
                                        "if (!spec.passed) {",
                                            "spec.failures.forEach(function(fail) {",
                                                "fails.push(fail);",
                                            "});",
                                        "}",
                                    "});",
                                    "fails.concat(getFailures(suite.suites));",
                                "});",
                                "return fails;",
                            "};",
                             "emit(doc.sha, {",
                                "\"total\":doc.mobilespec.total,",
                                "\"passed\":(doc.mobilespec.total - doc.mobilespec.failed),",
                                "\"version\":doc.version,",
                                "\"model\":doc.model,",
                                "\"fails\":getFailures(doc.mobilespec.suites)",
                             "});",
                         "}",
                     "}"].join('')
        },
        "ios" : {
            "map" : ["function(doc){",
                         "if (doc.platform == 'ios' && doc.mobilespec) {",
                            "function getFailures(suites) {",
                                "var fails = [];",
                                "suites.forEach(function(suite) {",
                                    "suite.specs.forEach(function(spec) {",
                                        "if (!spec.passed) {",
                                            "spec.failures.forEach(function(fail) {",
                                                "fails.push(fail);",
                                            "});",
                                        "}",
                                    "});",
                                    "fails.concat(getFailures(suite.suites));",
                                "});",
                                "return fails;",
                            "};",
                             "emit(doc.sha, {",
                                "\"total\":doc.mobilespec.total,",
                                "\"passed\":(doc.mobilespec.total - doc.mobilespec.failed),",
                                "\"version\":doc.version,",
                                "\"model\":doc.model,",
                                "\"fails\":getFailures(doc.mobilespec.suites)",
                             "});",
                         "}",
                     "}"].join('')
        }
    }
}
